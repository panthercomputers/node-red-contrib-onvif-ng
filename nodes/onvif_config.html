<!--
  Original work:
  Copyright 2018 Bart Butenaers

  Modifications:
  Copyright 2025 Panther Computers

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0
-->
<script type="text/javascript">
RED.nodes.registerType('onvif-config', {
    category: 'config',
    color: '#ff758d',

    defaults: {
        xaddress: { value: "", required: true },
        port: { value: 80, required: true, validate: RED.validators.number() },
        timeout: { value: 30, required: true, validate: RED.validators.number() },
        checkConnectionInterval: { value: 5, validate: RED.validators.number() },
        name: { value: "" }
    },

    credentials: {
        user: { type: "text" },
        password: { type: "password" }
    },

    label: function () {
        return this.name || this.xaddress || "ONVIF Device";
    },

    oneditprepare: function () {
        // Backward compatibility for older nodes
        if (this.timeout === undefined) {
            $("#node-config-input-timeout").val(30);
        }

        if (this.checkConnectionInterval === undefined) {
            $("#node-config-input-checkConnectionInterval").val(5);
        }
    }
});
</script>

<script type="text/x-red" data-template-name="onvif-config">
    <div class="form-row">
        <label for="node-config-input-xaddress">
            <i class="fa fa-globe"></i> IP address / Hostname
        </label>
        <input type="text" id="node-config-input-xaddress" placeholder="192.168.1.100">
    </div>

    <div class="form-row">
        <label for="node-config-input-port">
            <i class="fa fa-random"></i> Port
        </label>
        <input type="number" id="node-config-input-port" min="1" max="65535">
    </div>

    <div class="form-row">
        <label for="node-config-input-user">
            <i class="fa fa-user"></i> Username
        </label>
        <input type="text" id="node-config-input-user" autocomplete="username">
    </div>

    <div class="form-row">
        <label for="node-config-input-password">
            <i class="fa fa-lock"></i> Password
        </label>
        <input type="password" id="node-config-input-password" autocomplete="current-password">
    </div>

    <div class="form-row">
        <label for="node-config-input-timeout">
            <i class="fa fa-clock-o"></i> Timeout (seconds)
        </label>
        <input type="number" id="node-config-input-timeout" min="1">
    </div>

    <div class="form-row">
        <label for="node-config-input-checkConnectionInterval">
            <i class="fa fa-refresh"></i> Refresh interval (seconds)
        </label>
        <input type="number"
               id="node-config-input-checkConnectionInterval"
               min="0"
               style="width: 80px;">
        <span style="margin-left:6px;">(0 = disabled)</span>
    </div>

    <hr>

    <div class="form-row">
        <label for="node-config-input-name">
            <i class="fa fa-tag"></i> Name
        </label>
        <input type="text" id="node-config-input-name" placeholder="Camera Lobby East">
    </div>
</script>

<script type="text/x-red" data-help-name="onvif-config">
    <p>
        <strong>ONVIF Device Configuration</strong>
    </p>

    <p>
        This configuration node stores connection details for an ONVIF-compatible
        camera or encoder. Multiple ONVIF nodes can share the same configuration.
    </p>

    <p>
        <strong>IP address / Hostname</strong><br>
        The IP address or DNS hostname of the ONVIF device. You can discover this
        automatically using the <em>ONVIF Discovery</em> node.
    </p>

    <p>
        <strong>Port</strong><br>
        The ONVIF service port. This is commonly <code>80</code>, <code>8000</code>,
        or <code>8899</code>, depending on the manufacturer.
    </p>

    <p>
        <strong>Username / Password</strong><br>
        Credentials used for ONVIF authentication. These are stored securely using
        Node-RED credentials and are not exported in flows.
    </p>

    <p>
        <strong>Timeout</strong><br>
        Maximum time (in seconds) to wait for a response from the device before
        considering it disconnected.
    </p>

    <p>
        <strong>Refresh interval</strong><br>
        How often the node checks the device connection status. Set to
        <code>0</code> to disable automatic checks.
    </p>
</script>

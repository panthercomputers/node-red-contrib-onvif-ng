<!--
  Original work:
  Copyright 2018 Bart Butenaers

  Modifications:
  Copyright 2025 Panther Computers

  Licensed under the Apache License, Version 2.0
-->
<script type="text/javascript">
RED.nodes.registerType('onvif-ptz',{
    category: 'OnVif',
    color: '#ff758d',
    defaults: {
        name: {value:""},
        deviceConfig: {value:"", type:"onvif-config"},
        profileName: {value:""},
        action: {value:""},
        panSpeed: {value:0},
        tiltSpeed: {value:0},
        zoomSpeed: {value:0},
        panPosition: {value:0},
        tiltPosition: {value:0},
        zoomPosition: {value:0},
        panTranslation: {value:0},
        tiltTranslation: {value:0},
        zoomTranslation: {value:0},
        time: {value:1},
        preset: {value:""},
        presetName: {value:""},
        stopPanTilt: {value:true},
        stopZoom: {value:true},
        configurationToken: {value:""}
    },
    inputs:1,
    outputs:1,
    icon:"ptz.png",
    label: function() {
        return this.name || "OnVIf PTZ";
    },
    oneditprepare: function () {
        $("#node-input-action").on("change", function () {
            $(".actionParam-row").hide();
            const a = $(this).val();
            const show = ids => ids.forEach(id => $("#"+id).show());

            switch (a) {
                case "continuousMove":
                    show(["profileName-div","panSpeed-div","tiltSpeed-div","zoomSpeed-div","time-div"]);
                    break;
                case "absoluteMove":
                    show(["profileName-div","panSpeed-div","tiltSpeed-div","zoomSpeed-div","panPosition-div","tiltPosition-div","zoomPosition-div","time-div"]);
                    break;
                case "relativeMove":
                    show(["profileName-div","panTranslation-div","tiltTranslation-div","zoomTranslation-div"]);
                    break;
                case "gotoPreset":
                    show(["profileName-div","preset-div","panSpeed-div","tiltSpeed-div","zoomSpeed-div"]);
                    break;
                case "setPreset":
                    show(["profileName-div","preset-div","presetName-div"]);
                    break;
                case "removePreset":
                case "getPresets":
                case "getStatus":
                case "gotoHomePosition":
                case "setHomePosition":
                    show(["profileName-div"]);
                    break;
                case "stop":
                    show(["profileName-div","stopPanTilt-div","stopZoom-div"]);
                    break;
                case "getConfigurationOptions":
                    show(["configurationToken-div"]);
                    break;
            }
        });
    }
});
</script>

<script type="text/x-red" data-template-name="onvif-ptz">
    <div class="form-row">
        <label>Device</label>
        <input type="text" id="node-input-deviceConfig">
    </div>

    <div class="form-row">
        <label>Action</label>
        <select id="node-input-action">
            <option value=""></option>
            <option value="continuousMove">Continuous move</option>
            <option value="absoluteMove">Absolute move</option>
            <option value="relativeMove">Relative move</option>
            <option value="gotoHomePosition">Goto home</option>
            <option value="setHomePosition">Set home</option>
            <option value="getPresets">Get presets</option>
            <option value="setPreset">Set preset</option>
            <option value="gotoPreset">Goto preset</option>
            <option value="removePreset">Remove preset</option>
            <option value="getStatus">Get status</option>
            <option value="stop">Stop</option>
            <option value="reconnect">Reconnect</option>
        </select>
    </div>

    <div class="form-row actionParam-row" id="profileName-div">
        <label>Profile</label>
        <input type="text" id="node-input-profileName">
    </div>

    <!-- numeric fields unchanged, kept simple -->
    <!-- Name -->
    <div class="form-row">
        <label>Name</label>
        <input type="text" id="node-input-name">
    </div>
</script>

<script type="text/x-red" data-help-name="onvif-ptz">
<p>Control Pan/Tilt/Zoom functions on an ONVIF device.</p>
</script>

<!--
  Original work:
  Copyright 2018 Bart Butenaers

  Modifications:
  Copyright 2025 Panther Computers

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0
-->
<script type="text/javascript">
RED.nodes.registerType('onvif-device', {
    category: 'OnVif',
    color: '#ff758d',

    defaults: {
        name: { value: "" },
        deviceConfig: { value: "", type: "onvif-config", required: true },
        action: { value: "" }
    },

    inputs: 1,
    outputs: 1,
    icon: "device.png",

    label: function () {
        return this.name || "ONVIF Device";
    },

    oneditprepare: function () {
        // No dynamic UI yet, placeholder for future extension
    }
});
</script>

<script type="text/x-red" data-template-name="onvif-device">
    <div class="form-row">
        <label for="node-input-deviceConfig">
            <i class="fa fa-cog"></i> Device
        </label>
        <input type="text" id="node-input-deviceConfig">
    </div>

    <div class="form-row">
        <label for="node-input-action">
            <i class="fa fa-wrench"></i> Action
        </label>
        <select id="node-input-action">
            <option value="">— set via msg.action —</option>
            <option value="getDeviceInformation">Get device information</option>
            <option value="getHostname">Get hostname</option>
            <option value="getSystemDateAndTime">Get system date &amp; time</option>
            <option value="getServices">Get services</option>
            <option value="getCapabilities">Get capabilities</option>
            <option value="getScopes">Get scopes</option>
            <option value="systemReboot">Reboot device</option>
            <option value="getServiceCapabilities">Get service capabilities</option>
            <option value="reconnect">Reconnect</option>
        </select>
    </div>

    <hr>

    <div class="form-row">
        <label for="node-input-name">
            <i class="fa fa-tag"></i> Name
        </label>
        <input type="text" id="node-input-name" placeholder="ONVIF Device">
    </div>
</script>

<script type="text/x-red" data-help-name="onvif-device">
    <p>
        <strong>ONVIF Device</strong>
    </p>

    <p>
        This node interacts with the ONVIF Device service only (device metadata, capabilities, reboot).
  <ul>
    <li>This node is read-only / control-plane</li>
    <li>Explicitly state that it does NOT stream media</li>
</ul>
    </p>

    <p>
        <strong>Device</strong><br>
        Reference to an <em>ONVIF Config</em> node containing the connection
        details and credentials.
    </p>

    <p>
        <strong>Action</strong><br>
        The ONVIF device action to execute. If left empty, the action
        must be supplied via <code>msg.action</code>.
    </p>

    <p>
        <strong>Output</strong><br>
        The output message will contain:
        <ul>
            <li><code>msg.payload</code> – returned data (if any)</li>
            <li><code>msg.action</code> – executed action</li>
            <li><code>msg.xaddr</code> – device address</li>
        </ul>
    </p>
</script>




<!--
  Copyright 2025 Panther Computers

  Licensed under the Apache License, Version 2.0
-->

<script type="text/javascript">
RED.nodes.registerType('onvif-media-profile',{
    category: 'OnVif',
    color: '#ff758d',
    defaults: {
        name: { value:"" },
        deviceConfig: { value:"", type:"onvif-config", required:true },
        action: { value:"" },
        profileToken: { value:"" },
        profileName: { value:"" }
    },
    inputs:1,
    outputs:1,
    icon:"font-awesome/fa-sliders",
    label: function() {
        return this.name || "ONVIF Media Profile";
    },
    oneditprepare: function () {
        $(".actionParam-row").hide();

        $("#node-input-action").on("change", function () {
            $(".actionParam-row").hide();
            const a = $(this).val();

            if (a === "createProfile") {
                $("#profileName-row").show();
                $("#profileToken-row").show();
            }

            if (a === "deleteProfile") {
                $("#profileName-row").show();
            }
        });
    }
});
</script>

<script type="text/x-red" data-template-name="onvif-media-profile">
    <div class="form-row">
        <label><i class="fa fa-cog"></i> Device</label>
        <input type="text" id="node-input-deviceConfig">
    </div>

    <div class="form-row">
        <label><i class="fa fa-wrench"></i> Action</label>
        <select id="node-input-action">
            <option value="">— via msg.action —</option>
            <option value="getProfiles">Get profiles</option>
            <option value="createProfile">Create profile</option>
            <option value="deleteProfile">Delete profile</option>
        </select>
    </div>

    <div class="form-row actionParam-row" id="profileToken-row">
        <label>Source Profile (clone from)
</label>
        <input type="text" id="node-input-profileToken">
    </div>

    <div class="form-row actionParam-row" id="profileName-row">
        <label>Profile name</label>
        <input type="text" id="node-input-profileName">
    </div>

    <hr>

    <div class="form-row">
        <label>Name</label>
        <input type="text" id="node-input-name">
    </div>
</script>

<script type="text/x-red" data-help-name="onvif-media-profile">
<p>
<strong>ONVIF Media Profile — Media Profile Management</strong>
</p><p>
<strong>Purpose</strong>
</p><p>
This node manages ONVIF Media Profiles.
</p><p>
Depending on the selected action, it can:
<ul><li>
List profiles
</li><li>
Create profiles
</li><li>
Delete profiles
</li><li>
Retrieve profile details
</li></ul>
Profile selection
<ul><li>
Profiles are identified internally by ProfileToken
</li><li>
The UI allows selecting from cached profiles
</li><li>
Tokens are resolved automatically when a profile name is selected
</li></ul>
</p><p>
Status meanings
</p><p>
<ul><li>
connected – Media service available
</li><li>
unsupported – Media service not advertised
</li><li>
disconnected – Camera unreachable
</li></ul>
</p><p>
Tip
Use Get Profiles first to discover available profiles.
</p><hr><p>
<strong>Profiles</strong>
</p><p>
ONVIF profiles are discovered and cached when the device connects.
</p><p>
To view available profiles:
</p><p>
Use an onvif-media-profile node with action Get Profiles
</p><p>
Inspect the output to see profile names and tokens
</p><p>
<strong>Create Profile </strong>
</p><p>
For actions like Create Profile or Delete Profile:
</p><p>
Provide either:
</p><p>
profileName (recommended), or profileToken
</p><p>
ONVIF profiles are created by cloning an existing profile.
</p><p>
You must select an existing profile (via Profile Name), or provide a ProfileToken
</p><p>
The new profile will inherit settings from the selected profile.
</p>
<p>
<strong>Delete Profile</strong>
<p>
Deletes the selected profile.
</p><p>
The profile can be selected by name or token.
</p><p>
<strong>Warning:</strong> Creating or deleting profiles can affect existing
streams. Use with care.
</p>
</script>
